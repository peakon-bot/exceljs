{"version":3,"sources":["../../../../../lib/xlsx/xform/drawing/two-cell-anchor-xform.js"],"names":["utils","require","colCache","BaseXform","StaticXform","CellPositionXform","PicXform","TwoCellAnchorXform","module","exports","map","tag","inherits","prepare","model","options","picture","range","decode","tl","col","left","row","top","br","right","bottom","render","xmlStream","openNode","closeNode","parseOpen","node","parser","name","reset","parseText","text","parseClose","undefined","reconcile","rel","rels","rId","match","Target","mediaId","mediaIndex","medium","media","Number","isInteger","encode"],"mappings":"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","file":"two-cell-anchor-xform.js","sourcesContent":["/**\n * Copyright (c) 2016-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar utils = require('../../../utils/utils');\nvar colCache = require('../../../utils/col-cache');\nvar BaseXform = require('../base-xform');\nvar StaticXform = require('../static-xform');\n\nvar CellPositionXform = require('./cell-position-xform');\nvar PicXform = require('./pic-xform');\n\nvar TwoCellAnchorXform = module.exports = function() {\n  this.map = {\n    'xdr:from': new CellPositionXform({tag: 'xdr:from'}),\n    'xdr:to': new CellPositionXform({tag: 'xdr:to'}),\n    'xdr:pic': new PicXform(),\n    'xdr:clientData': new StaticXform({tag: 'xdr:clientData'}),\n  };\n};\n\nutils.inherits(TwoCellAnchorXform, BaseXform, {\n  get tag() { return 'xdr:twoCellAnchor'; },\n\n  prepare: function(model, options) {\n    this.map['xdr:pic'].prepare(model.picture, options);\n\n    // convert model.range into tl, br\n    if (typeof model.range === 'string') {\n      var range = colCache.decode(model.range);\n      // Note - zero based\n      model.tl = {\n        col: range.left - 1,\n        row: range.top - 1,\n      };\n      // zero based but also +1 to cover to bottom right of br cell\n      model.br = {\n        col: range.right,\n        row: range.bottom\n      };\n    } else {\n      model.tl = model.range.tl;\n      model.br = model.range.br;\n    }\n  },\n\n  render: function(xmlStream, model) {\n    xmlStream.openNode(this.tag);\n\n    this.map['xdr:from'].render(xmlStream, model.tl);\n    this.map['xdr:to'].render(xmlStream, model.br);\n    this.map['xdr:pic'].render(xmlStream, model.picture);\n    this.map['xdr:clientData'].render(xmlStream, {});\n\n    xmlStream.closeNode();\n  },\n\n  parseOpen: function(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case this.tag:\n        this.reset();\n        break;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n        break;\n    }\n    return true;\n  },\n\n  parseText: function(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n\n  parseClose: function(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case this.tag:\n        this.model = {\n          tl: this.map['xdr:from'].model,\n          br: this.map['xdr:to'].model,\n          picture: this.map['xdr:pic'].model,\n        };\n        return false;\n      default:\n        // could be some unrecognised tags\n        return true;\n    }\n  },\n\n  reconcile: function(model, options) {\n    var rel = options.rels[model.picture.rId];\n    var match = rel.Target.match(/.*\\/media\\/(.+[.][a-z]{3,4})/);\n    if (match) {\n      var name = match[1];\n      var mediaId = options.mediaIndex[name];\n      model.medium = options.media[mediaId];\n    }\n    if (Number.isInteger(model.tl.row) && Number.isInteger(model.tl.col) && Number.isInteger(model.br.row) && Number.isInteger(model.br.col)) {\n      model.range = colCache.encode(model.tl.row + 1, model.tl.col + 1, model.br.row, model.br.col);\n    } else {\n      model.range = {\n        tl: model.tl,\n        br: model.br,\n      };\n    }\n    delete model.tl;\n    delete model.br;\n  }\n});\n"]}