{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/sheet-view-xform.js"],"names":["utils","require","colCache","BaseXform","VIEW_STATES","frozen","frozenSplit","split","SheetViewXform","module","exports","inherits","tag","prepare","model","state","render","xmlStream","openNode","workbookViewId","add","name","value","included","addAttribute","tabSelected","showRuler","showRowColHeaders","showGridLines","zoomScale","zoomScaleNormal","style","topLeftCell","xSplit","ySplit","activePane","getAddress","address","leafNode","undefined","pane","activeCell","sqref","closeNode","parseOpen","node","sheetView","parseInt","attributes","view","selections","parseText","parseClose","selection","topLeft","reconcile"],"mappings":"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","file":"sheet-view-xform.js","sourcesContent":["/**\n * Copyright (c) 2016 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar utils = require('../../../utils/utils');\nvar colCache = require('../../../utils/col-cache');\nvar BaseXform = require('../base-xform');\n\nvar VIEW_STATES = {\n  frozen: 'frozen',\n  frozenSplit: 'frozen',\n  split: 'split'\n};\n\nvar SheetViewXform = module.exports = function() {\n};\n\nutils.inherits(SheetViewXform, BaseXform, {\n  \n  get tag() { return 'sheetView'; },\n  \n  prepare: function(model) {\n    switch (model.state) {\n      case 'frozen':\n      case 'split':\n        break;\n      default:\n        model.state = 'normal';\n        break;\n    }\n  },\n\n  render: function(xmlStream, model) {\n    xmlStream.openNode('sheetView', {\n      workbookViewId: model.workbookViewId || 0\n    });\n    var add = function(name, value, included) {\n      if (included) {\n        xmlStream.addAttribute(name, value);\n      }\n    };\n    add('tabSelected', '1', model.tabSelected);\n    add('showRuler', '0', model.showRuler === false);\n    add('showRowColHeaders', '0', model.showRowColHeaders === false);\n    add('showGridLines', '0', model.showGridLines === false);\n    add('zoomScale', model.zoomScale, model.zoomScale);\n    add('zoomScaleNormal', model.zoomScaleNormal, model.zoomScaleNormal);\n    add('view', model.style, model.style);\n    \n    var topLeftCell, xSplit, ySplit, activePane;\n    switch (model.state) {\n      case 'frozen':\n        xSplit = model.xSplit || 0;\n        ySplit = model.ySplit || 0;\n        topLeftCell = model.topLeftCell || colCache.getAddress(ySplit + 1, xSplit + 1).address;\n        activePane =\n          ((model.xSplit && model.ySplit) && 'bottomRight') ||\n          (model.xSplit && 'topRight') ||\n          'bottomLeft';\n\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell: topLeftCell,\n          activePane: activePane,\n          state: 'frozen'\n        });\n        xmlStream.leafNode('selection', {\n          pane: activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell\n        });\n        break;\n      case 'split':\n        if (model.activePane === 'topLeft') {\n          model.activePane = undefined;\n        }\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell: model.topLeftCell,\n          activePane: model.activePane\n        });\n        xmlStream.leafNode('selection', {\n          pane: model.activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell\n        });\n        break;\n      case 'normal':\n        if (model.activeCell) {\n          xmlStream.leafNode('selection', {\n            activeCell: model.activeCell,\n            sqref: model.activeCell\n          });\n        }\n        break;\n      default:\n        break;\n    }\n    xmlStream.closeNode();\n  },\n  \n  parseOpen: function(node) {\n    switch (node.name) {\n      case 'sheetView':\n        this.sheetView = {\n          workbookViewId: parseInt(node.attributes.workbookViewId, 10),\n          tabSelected: node.attributes.tabSelected === '1',\n          showRuler: !(node.attributes.showRuler === '0'),\n          showRowColHeaders: !(node.attributes.showRowColHeaders === '0'),\n          showGridLines: !(node.attributes.showGridLines === '0'),\n          zoomScale: parseInt(node.attributes.zoomScale || '100', 10),\n          zoomScaleNormal: parseInt(node.attributes.zoomScaleNormal || '100', 10),\n          style: node.attributes.view\n        };\n        this.pane = undefined;\n        this.selections = {};\n        return true;\n      case 'pane':\n        this.pane = {\n          xSplit: parseInt(node.attributes.xSplit || '0', 10),\n          ySplit: parseInt(node.attributes.ySplit || '0', 10),\n          topLeftCell: node.attributes.topLeftCell,\n          activePane: node.attributes.activePane || 'topLeft',\n          state: node.attributes.state\n        };\n        return true;\n      case 'selection':\n        var name = node.attributes.pane || 'topLeft';\n        this.selections[name] = {\n          pane: name,\n          activeCell: node.attributes.activeCell\n        };\n        return true;\n      default:\n        return false;\n    }\n  },\n  parseText: function() {\n  },\n  parseClose: function(name) {\n    var model, selection;\n    switch (name) {\n      case 'sheetView':\n        if (this.sheetView && this.pane) {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            state: VIEW_STATES[this.pane.state] || 'split', // split is default\n            xSplit: this.pane.xSplit,\n            ySplit: this.pane.ySplit,\n            topLeftCell: this.pane.topLeftCell,\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal\n          };\n          if (this.model.state === 'split') {\n            model.activePane = this.pane.activePane;\n          }\n          selection = this.selections[this.pane.activePane];\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        } else {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            state: 'normal',\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal\n          };\n          selection = this.selections.topLeft;\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        }\n        return false;\n      default:\n        return true;\n    }\n  },\n  \n  reconcile: function() {\n  }\n});\n"]}