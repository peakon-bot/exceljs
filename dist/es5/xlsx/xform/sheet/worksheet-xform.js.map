{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"names":["_","require","utils","XmlStream","RelType","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","WorkSheetXform","module","exports","maxRows","console","log","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","autoFilter","mergeCells","hyperlinks","pageMargins","dataValidations","pageSetup","printOptions","picture","drawing","inherits","WORKSHEET_ATTRIBUTES","xmlns","prepare","model","options","merges","formulae","siFormulae","rows","rels","nextRid","r","length","rId","forEach","hyperlink","push","Id","Type","Hyperlink","Target","target","TargetMode","drawingRelsHash","bookImage","media","medium","type","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","range","render","xmlStream","openXml","StdDocAttributes","openNode","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","undefined","sheetPropertiesModel","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","dimensions","views","closeNode","parseOpen","node","parser","each","xform","reset","parseText","text","parseClose","sheetProperties","Object","assign","reconcile","relationships","reduce","h","rel","hyperlinkMap","address","filter","Boolean","row","cells","drawingRel","match","drawingName","anchor","index","backgroundRel","split","mediaIndex"],"mappings":"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","file":"worksheet-xform.js","sourcesContent":["/**\n * Copyright (c) 2016 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar _ = require('../../../utils/under-dash');\n\nvar utils = require('../../../utils/utils');\nvar XmlStream = require('../../../utils/xml-stream');\n\nvar RelType = require('../../rel-type');\n\nvar Merges = require('./merges');\n\nvar BaseXform = require('../base-xform');\nvar ListXform = require('../list-xform');\nvar RowXform = require('./row-xform');\nvar ColXform = require('./col-xform');\nvar DimensionXform = require('./dimension-xform');\nvar HyperlinkXform = require('./hyperlink-xform');\nvar MergeCellXform = require('./merge-cell-xform');\nvar DataValidationsXform = require('./data-validations-xform');\nvar SheetPropertiesXform = require('./sheet-properties-xform');\nvar SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\nvar SheetViewXform = require('./sheet-view-xform');\nvar PageMarginsXform = require('./page-margins-xform');\nvar PageSetupXform = require('./page-setup-xform');\nvar PrintOptionsXform = require('./print-options-xform');\nvar AutoFilterXform = require('./auto-filter-xform');\nvar PictureXform = require('./picture-xform');\nvar DrawingXform = require('./drawing-xform');\n\nvar WorkSheetXform = module.exports = function(maxRows) {\nconsole.log('new WorkSheetXorm', maxRows);\n  this.map = {\n    sheetPr: new SheetPropertiesXform(),\n    dimension: new DimensionXform(),\n    sheetViews: new ListXform({tag: 'sheetViews', count: false, childXform: new SheetViewXform()}),\n    sheetFormatPr: new SheetFormatPropertiesXform(),\n    cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\n    sheetData: new ListXform({tag: 'sheetData', count: false, empty: true, childXform: new RowXform(maxRows)}),\n    autoFilter: new AutoFilterXform(),\n    mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\n    hyperlinks: new ListXform({tag: 'hyperlinks', count: false, childXform: new HyperlinkXform()}),\n    pageMargins: new PageMarginsXform(),\n    dataValidations: new DataValidationsXform(),\n    pageSetup: new PageSetupXform(),\n    printOptions: new PrintOptionsXform(),\n    picture: new PictureXform(),\n    drawing: new DrawingXform(),\n  };\n};\n\nutils.inherits(WorkSheetXform, BaseXform, {\n  WORKSHEET_ATTRIBUTES: {\n    xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n    'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\n    'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n    'mc:Ignorable': 'x14ac',\n    'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac'\n  }\n}, {\n  prepare: function(model, options) {\n    options.merges = new Merges();\n    model.hyperlinks = options.hyperlinks = [];\n\n    options.formulae = {};\n    options.siFormulae = 0;\n    this.map.cols.prepare(model.cols, options);\n    this.map.sheetData.prepare(model.rows, options);\n\n    model.mergeCells = options.merges.mergeCells;\n\n    // prepare relationships\n    var rels = model.rels = [];\n    function nextRid(r) { return 'rId' + (r.length + 1); }\n    var rId;\n    model.hyperlinks.forEach(function(hyperlink) {\n      rId = nextRid(rels);\n      hyperlink.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Hyperlink,\n        Target: hyperlink.target,\n        TargetMode: 'External'\n      });\n    });\n\n    var drawingRelsHash = [];\n    var bookImage;\n    model.media.forEach(function(medium) {\n      if (medium.type === 'background') {\n        rId = nextRid(rels);\n        bookImage = options.media[medium.imageId];\n        rels.push({\n          Id: rId,\n          Type: RelType.Image,\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\n        });\n        model.background = {\n          rId,\n        };\n        model.image = options.media[medium.imageId];\n      } else if (medium.type === 'image') {\n        var drawing = model.drawing;\n        bookImage = options.media[medium.imageId];\n        if (!drawing) {\n          drawing = model.drawing = {\n            rId: nextRid(rels),\n            name: 'drawing' + (++options.drawingsCount),\n            anchors: [],\n            rels: [],\n          };\n          options.drawings.push(drawing);\n          rels.push({\n            Id: drawing.rId,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\n            Target: '../drawings/' + drawing.name + '.xml',\n          });\n        }\n        var rIdImage = drawingRelsHash[medium.imageId];\n        if (!rIdImage) {\n          rIdImage = nextRid(drawing.rels);\n          drawingRelsHash[medium.imageId] = rIdImage;\n          drawing.rels.push({\n            Id: rIdImage,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\n          });\n        }\n        drawing.anchors.push({\n          picture: {\n            rId: rIdImage,\n          },\n          range: medium.range,\n        });\n      }\n    });\n  },\n\n  render: function(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\n\n    var sheetFormatPropertiesModel = model.properties ? {\n      defaultRowHeight: model.properties.defaultRowHeight,\n      dyDescent: model.properties.dyDescent,\n      outlineLevelCol: model.properties.outlineLevelCol,\n      outlineLevelRow: model.properties.outlineLevelRow\n    } : undefined;\n    var sheetPropertiesModel = {\n      tabColor: model.properties && model.properties.tabColor,\n      pageSetup: model.pageSetup && model.pageSetup.fitToPage ? {\n        fitToPage: model.pageSetup.fitToPage\n      } : undefined\n    };\n    var pageMarginsModel = model.pageSetup && model.pageSetup.margins;\n    var printOptionsModel = {\n      showRowColHeaders: model.showRowColHeaders,\n      showGridLines: model.showGridLines,\n      horizontalCentered: model.horizontalCentered,\n      verticalCentered: model.verticalCentered\n    };\n\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\n    this.map.dimension.render(xmlStream, model.dimensions);\n    this.map.sheetViews.render(xmlStream, model.views);\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\n    this.map.cols.render(xmlStream, model.cols);\n    this.map.sheetData.render(xmlStream, model.rows);\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\n    // For some reason hyperlinks have to be after the data validations\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\n    this.map.printOptions.render(xmlStream, printOptionsModel);\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\n    this.map.drawing.render(xmlStream, model.drawing);\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\n\n    xmlStream.closeNode();\n  },\n\n  parseOpen: function(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    if (node.name === 'worksheet') {\n      _.each(this.map, function(xform) {\n        xform.reset();\n      });\n      return true;\n    }\n\n    this.parser = this.map[node.name];\n    if (this.parser) {\n      this.parser.parseOpen(node);\n    }\n    return true;\n  },\n  parseText: function(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  },\n  parseClose: function(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'worksheet':\n        var properties = this.map.sheetFormatPr.model;\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\n          properties.tabColor = this.map.sheetPr.model.tabColor;\n        }\n        var sheetProperties = {\n          fitToPage: (this.map.sheetPr.model && this.map.sheetPr.model.pageSetup && this.map.sheetPr.model.pageSetup.fitToPage) || false,\n          margins: this.map.pageMargins.model\n        };\n        var pageSetup = Object.assign(\n          sheetProperties,\n          this.map.pageSetup.model,\n          this.map.printOptions.model\n        );\n        this.model = {\n          dimensions: this.map.dimension.model,\n          cols: this.map.cols.model,\n          rows: this.map.sheetData.model,\n          mergeCells: this.map.mergeCells.model,\n          hyperlinks: this.map.hyperlinks.model,\n          dataValidations: this.map.dataValidations.model,\n          properties: properties,\n          views: this.map.sheetViews.model,\n          pageSetup: pageSetup,\n          background: this.map.picture.model,\n          drawing: this.map.drawing.model,\n        };\n\n        if (this.map.autoFilter.model) {\n          this.model.autoFilter = this.map.autoFilter.model;\n        }\n        return false;\n      default:\n        // not quite sure how we get here!\n        return true;\n    }\n  },\n\n  reconcile: function(model, options) {\n    // options.merges = new Merges();\n    // options.merges.reconcile(model.mergeCells, model.rows);\n    var rels = (model.relationships || []).reduce(function(h, rel) {\n      h[rel.Id] = rel;\n      return h;\n    }, {});\n    options.hyperlinkMap = (model.hyperlinks || []).reduce(function(h, hyperlink) {\n      if (hyperlink.rId) {\n        h[hyperlink.address] = rels[hyperlink.rId].Target;\n      }\n      return h;\n    }, {});\n    options.formulae = {};\n\n    // compact the rows and cells\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\n    model.rows.forEach(function(row) {\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\n    });\n\n    this.map.cols.reconcile(model.cols, options);\n    this.map.sheetData.reconcile(model.rows, options);\n\n    model.media = [];\n    if (model.drawing) {\n      var drawingRel = rels[model.drawing.rId];\n      var match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\n      if (match) {\n        var drawingName = match[1];\n        var drawing = options.drawings[drawingName];\n        drawing.anchors.forEach(anchor => {\n          if (anchor.medium) {\n            var image = {\n              type: 'image',\n              imageId: anchor.medium.index,\n              range: anchor.range,\n            };\n            model.media.push(image);\n          }\n        });\n      }\n    }\n\n    var backgroundRel = model.background && rels[model.background.rId];\n    if (backgroundRel) {\n      var target = backgroundRel.Target.split('/media/')[1];\n      var imageId = options.mediaIndex && options.mediaIndex[target];\n      if (imageId !== undefined) {\n        model.media.push({\n          type: 'background',\n          imageId,\n        });\n      }\n    }\n\n\n    delete model.relationships;\n    delete model.hyperlinks;\n  }\n});\n\n"]}