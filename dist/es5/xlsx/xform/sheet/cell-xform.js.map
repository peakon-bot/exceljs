{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/cell-xform.js"],"names":["utils","require","BaseXform","Enums","Range","getValueType","v","undefined","ValueType","Null","String","Number","Boolean","Date","text","hyperlink","Hyperlink","formula","Formula","error","Error","getEffectiveCellType","cell","type","result","CellXform","module","exports","inherits","tag","prepare","model","options","styleId","styles","addStyleModel","style","sharedStrings","ssId","add","value","date1904","hyperlinks","push","address","target","Merge","merges","formulae","sharedFormula","master","si","ref","expandToAddress","siFormulae","renderFormula","xmlStream","attrs","t","range","leafNode","addAttribute","dateToExcel","render","openNode","closeNode","parseOpen","node","name","attributes","r","s","parseInt","currentNode","parseText","parseClose","xmlDecode","parseFloat","reconcile","getStyleModel","getString","richText","RichText","isDateFmt","numFmt","excelToDate","hyperlinkMap"],"mappings":"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","file":"cell-xform.js","sourcesContent":["/**\n * Copyright (c) 2015 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar utils = require('../../../utils/utils');\nvar BaseXform = require('../base-xform');\n\nvar Enums = require('../../../doc/enums');\nvar Range = require('../../../doc/range');\n\n\nfunction getValueType(v) {\n  if ((v === null) || (v === undefined)) {\n    return Enums.ValueType.Null;\n  } else if ((v instanceof String) || (typeof v === 'string')) {\n    return Enums.ValueType.String;\n  } else if (typeof v === 'number') {\n    return Enums.ValueType.Number;\n  } else if (typeof v === 'boolean') {\n    return Enums.ValueType.Boolean;\n  } else if (v instanceof Date) {\n    return Enums.ValueType.Date;\n  } else if (v.text && v.hyperlink) {\n    return Enums.ValueType.Hyperlink;\n  } else if (v.formula) {\n    return Enums.ValueType.Formula;\n  } else if (v.error) {\n    return Enums.ValueType.Error;\n  }\n  throw new Error('I could not understand type of value');\n}\n\nfunction getEffectiveCellType(cell) {\n  switch (cell.type) {\n    case Enums.ValueType.Formula:\n      return getValueType(cell.result);\n    default:\n      return cell.type;\n  }\n}\n\n\nvar CellXform = module.exports = function() {\n};\n\nutils.inherits(CellXform, BaseXform, {\n\n  get tag() { return 'c'; },\n\n  prepare: function(model, options) {\n    var styleId = options.styles.addStyleModel(model.style || {}, getEffectiveCellType(model));\n    if (styleId) {\n      model.styleId = styleId;\n    }\n\n    switch (model.type) {\n      case Enums.ValueType.String:\n        if (options.sharedStrings) {\n          model.ssId = options.sharedStrings.add(model.value);\n        }\n        break;\n      case Enums.ValueType.Date:\n        if (options.date1904) {\n          model.date1904 = true;\n        }\n        break;\n      case Enums.ValueType.Hyperlink:\n        if (options.sharedStrings) {\n          model.ssId = options.sharedStrings.add(model.text);\n        }\n        options.hyperlinks.push({\n          address: model.address,\n          target: model.hyperlink\n        });\n        break;\n      case Enums.ValueType.Merge:\n        options.merges.add(model);\n        break;\n      case Enums.ValueType.Formula:\n        if (options.date1904) {\n          // in case valueType is date\n          model.date1904 = true;\n        }\n        if (model.formula) {\n          options.formulae[model.address] = model;\n        } else if (model.sharedFormula) {\n          const master = options.formulae[model.sharedFormula];\n          if (!master) {\n            throw new Error('Shared Formula master must exist above and or left of clone');\n          }\n          if (master.si !== undefined) {\n            model.si = master.si;\n            master.ref.expandToAddress(model.address);\n          } else {\n            model.si = master.si = options.siFormulae++;\n            master.ref = new Range(master.address, model.address);\n          }\n        }\n        break;\n      default:\n        break;\n    }\n  },\n\n  renderFormula: function(xmlStream, model) {\n    var attrs = null;\n    if (model.ref) {\n      attrs = {\n        t: 'shared',\n        ref: model.ref.range,\n        si: model.si,\n      };\n    } else if (model.si !== undefined) {\n      attrs = {\n        t: 'shared',\n        si: model.si,\n      };\n    }\n    switch (getValueType(model.result)) {\n      case Enums.ValueType.Null: // ?\n        xmlStream.leafNode('f', attrs, model.formula);\n        break;\n      case Enums.ValueType.String:\n        // oddly, formula results don't ever use shared strings\n        xmlStream.addAttribute('t', 'str');\n        xmlStream.leafNode('f', attrs, model.formula);\n        xmlStream.leafNode('v', null, model.result);\n        break;\n      case Enums.ValueType.Number:\n        xmlStream.leafNode('f', attrs, model.formula);\n        xmlStream.leafNode('v', null, model.result);\n        break;\n      case Enums.ValueType.Boolean:\n        xmlStream.addAttribute('t', 'b');\n        xmlStream.leafNode('f', attrs, model.formula);\n        xmlStream.leafNode('v', null, model.result ? 1 : 0);\n        break;\n      case Enums.ValueType.Error:\n        xmlStream.addAttribute('t', 'e');\n        xmlStream.leafNode('f', attrs, model.formula);\n        xmlStream.leafNode('v', null, model.result.error);\n        break;\n      case Enums.ValueType.Date:\n        xmlStream.leafNode('f', attrs, model.formula);\n        xmlStream.leafNode('v', null, utils.dateToExcel(model.result, model.date1904));\n        break;\n      // case Enums.ValueType.Hyperlink: // ??\n      // case Enums.ValueType.Formula:\n      default:\n        throw new Error('I could not understand type of value');\n    }\n  },\n\n  render: function(xmlStream, model) {\n    if ((model.type === Enums.ValueType.Null) && !model.styleId) {\n      // if null and no style, exit\n      return;\n    }\n\n    xmlStream.openNode('c');\n    xmlStream.addAttribute('r', model.address);\n\n    if (model.styleId) {\n      xmlStream.addAttribute('s', model.styleId);\n    }\n\n    switch (model.type) {\n      case Enums.ValueType.Null:\n        break;\n\n      case Enums.ValueType.Number:\n        xmlStream.leafNode('v', null, model.value);\n        break;\n\n      case Enums.ValueType.Boolean:\n        xmlStream.addAttribute('t', 'b');\n        xmlStream.leafNode('v', null, model.value ? '1' : '0');\n        break;\n\n      case Enums.ValueType.Error:\n        xmlStream.addAttribute('t', 'e');\n        xmlStream.leafNode('v', null, model.value.error);\n        break;\n\n      case Enums.ValueType.String:\n        if (model.ssId !== undefined) {\n          xmlStream.addAttribute('t', 's');\n          xmlStream.leafNode('v', null, model.ssId);\n        } else {\n          xmlStream.addAttribute('t', 'str');\n          xmlStream.leafNode('v', null, model.value);\n        }\n        break;\n\n      case Enums.ValueType.Date:\n        xmlStream.leafNode('v', null, utils.dateToExcel(model.value, model.date1904));\n        break;\n\n      case Enums.ValueType.Hyperlink:\n        if (model.ssId !== undefined) {\n          xmlStream.addAttribute('t', 's');\n          xmlStream.leafNode('v', null, model.ssId);\n        } else {\n          xmlStream.addAttribute('t', 'str');\n          xmlStream.leafNode('v', null, model.text);\n        }\n        break;\n\n      case Enums.ValueType.Formula:\n        this.renderFormula(xmlStream, model);\n        break;\n\n      case Enums.ValueType.Merge:\n        // nothing to add\n        break;\n\n      default:\n        break;\n    }\n\n    xmlStream.closeNode(); // </c>\n  },\n  \n  parseOpen: function(node) {\n    switch (node.name) {\n      case 'c':\n        // var address = colCache.decodeAddress(node.attributes.r);\n        var model = this.model = {\n          address: node.attributes.r\n        };\n        this.t = node.attributes.t;\n        if (node.attributes.s) {\n          model.styleId = parseInt(node.attributes.s, 10);\n        }\n        return true;\n\n      case 'f':\n        this.currentNode = 'f';\n        this.model.si = node.attributes.si;\n        if (node.attributes.t === 'shared') {\n          this.model.sharedFormula = true;\n        }\n        this.model.ref = node.attributes.ref;\n        return true;\n\n      case 'v':\n        this.currentNode = 'v';\n        return true;\n\n      default:\n        return false;\n    }\n  },\n  parseText: function(text) {\n    switch (this.currentNode) {\n      case 'f':\n        this.model.formula = this.model.formula ? this.model.formula + text : text;\n        break;\n      case 'v':\n        this.model.value = this.model.value ? this.model.value + text : text;\n        break;\n      default:\n        break;\n    }\n  },\n  parseClose: function(name) {\n    switch (name) {\n      case 'c':\n        var model = this.model;\n\n        // first guess on cell type\n        if (model.formula || model.sharedFormula) {\n          model.type = Enums.ValueType.Formula;\n          if (model.value) {\n            if (this.t === 'str') {\n              model.result = utils.xmlDecode(model.value);\n            } else if (this.t === 'b') {\n              model.result = parseInt(model.value, 10) !== 0;\n            } else if (this.t === 'e') {\n              model.result = { error: model.value };\n            } else {\n              model.result = parseFloat(model.value);\n            }\n            model.value = undefined;\n          }\n        } else if (model.value !== undefined) {\n          switch (this.t) {\n            case 's':\n              model.type = Enums.ValueType.String;\n              model.value = parseInt(model.value, 10);\n              break;\n            case 'str':\n              model.type = Enums.ValueType.String;\n              model.value = utils.xmlDecode(model.value);\n              break;\n            case 'b':\n              model.type = Enums.ValueType.Boolean;\n              model.value = parseInt(model.value, 10) !== 0;\n              break;\n            case 'e':\n              model.type = Enums.ValueType.Error;\n              model.value = { error: model.value };\n              break;\n            default:\n              model.type = Enums.ValueType.Number;\n              model.value = parseFloat(model.value);\n              break;\n          }\n        } else if (model.styleId) {\n          model.type = Enums.ValueType.Null;\n        } else {\n          model.type = Enums.ValueType.Merge;\n        }\n        return false;\n      case 'f':\n      case 'v':\n        this.currentNode = undefined;\n        return true;\n      default:\n        return false;\n    }\n  },\n\n  reconcile: function(model, options) {\n    var style = model.styleId && options.styles.getStyleModel(model.styleId);\n    if (style) {\n      model.style = style;\n    }\n    if (model.styleId !== undefined) {\n      model.styleId = undefined;\n    }\n\n    switch (model.type) {\n      case Enums.ValueType.String:\n        if (typeof model.value === 'number') {\n          model.value = options.sharedStrings.getString(model.value);\n        }\n        if (model.value.richText) {\n          model.type = Enums.ValueType.RichText;\n        }\n        break;\n      case Enums.ValueType.Number:\n        if (style && utils.isDateFmt(style.numFmt)) {\n          model.type = Enums.ValueType.Date;\n          model.value = utils.excelToDate(model.value, options.date1904);\n        }\n        break;\n      case Enums.ValueType.Formula:\n        if ((model.result !== undefined) && style && utils.isDateFmt(style.numFmt)) {\n          model.result = utils.excelToDate(model.result, options.date1904);\n        }\n        if (model.sharedFormula) {\n          if (model.formula) {\n            options.formulae[model.si] = model;\n            delete model.sharedFormula;\n          } else {\n            model.sharedFormula = options.formulae[model.si].address;\n          }\n          delete model.si;\n        }\n        break;\n      default:\n        break;\n    }\n    \n    // look for hyperlink\n    var hyperlink = options.hyperlinkMap[model.address];\n    if (hyperlink) {\n      model.type = Enums.ValueType.Hyperlink;\n      model.text = model.value;\n      model.value = undefined;\n      model.hyperlink = hyperlink;\n    }\n  }\n});\n"]}