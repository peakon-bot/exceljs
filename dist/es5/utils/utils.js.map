{"version":3,"sources":["../../../lib/utils/utils.js"],"names":["fs","require","PromishLib","inherits","cls","superCtor","statics","prototype","super_","Object","keys","forEach","defineProperty","i","getOwnPropertyDescriptor","properties","constructor","value","enumerable","writable","configurable","create","utils","module","exports","nop","promiseImmediate","Promish","resolve","global","setImmediate","setTimeout","dateToExcel","d","date1904","getTime","excelToDate","v","Date","parsePath","filepath","last","lastIndexOf","path","substring","name","getRelsPath","xmlEncode","text","replace","c","xmlDecode","validInt","parseInt","isNaN","isDateFmt","fmt","result","match","exists","toIsoDateString","dt","toIsoString","subsstr"],"mappings":"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","file":"utils.js","sourcesContent":["/**\n * Copyright (c) 2014-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar fs = require('fs');\nvar PromishLib = require('./promish');\n\n// useful stuff\nvar inherits = function(cls, superCtor, statics, prototype) {\n  // eslint-disable-next-line no-underscore-dangle\n  cls.super_ = superCtor;\n\n  if (!prototype) {\n    prototype = statics;\n    statics = null;\n  }\n\n  if (statics) {\n    Object.keys(statics).forEach(i => {\n      Object.defineProperty(cls, i, Object.getOwnPropertyDescriptor(statics, i));\n    });\n  }\n\n  var properties = {\n    constructor: {\n      value: cls,\n      enumerable: false,\n      writable: false,\n      configurable: true\n    }\n  };\n  if (prototype) {\n    Object.keys(prototype).forEach(i => {\n      properties[i] = Object.getOwnPropertyDescriptor(prototype, i);\n    });\n  }\n\n  cls.prototype = Object.create(superCtor.prototype, properties);\n};\n\n\nvar utils = module.exports = {\n  nop: function() {},\n  promiseImmediate: function(value) {\n    return new PromishLib.Promish(function(resolve) {\n      if (global.setImmediate) {\n        setImmediate(function() {\n          resolve(value);\n        });\n      } else {\n        // poorman's setImmediate - must wait at least 1ms\n        setTimeout(function() {\n          resolve(value);\n        }, 1);\n      }\n    });\n  },\n  inherits: inherits,\n  dateToExcel: function(d, date1904) {\n    return 25569 + (d.getTime() / (24 * 3600 * 1000)) - (date1904 ? 1462 : 0);\n  },\n  excelToDate: function(v, date1904) {\n    return new Date((v - 25569 + (date1904 ? 1462 : 0)) * 24 * 3600 * 1000);\n  },\n  parsePath: function(filepath) {\n    var last = filepath.lastIndexOf('/');\n    return {\n      path: filepath.substring(0, last),\n      name: filepath.substring(last + 1)\n    };\n  },\n  getRelsPath: function(filepath) {\n    var path = utils.parsePath(filepath);\n    return path.path + '/_rels/' + path.name + '.rels';\n  },\n  xmlEncode: function(text) {\n    // eslint-disable-next-line no-control-regex\n    return text.replace(/[<>&'\"\\x7F\\x00-\\x08\\x0B-\\x0C\\x0E-\\x1F]/g, function(c) {\n      switch (c) {\n        case '<': return '&lt;';\n        case '>': return '&gt;';\n        case '&': return '&amp;';\n        case '\\'': return '&apos;';\n        case '\"': return '&quot;';\n        default: return '';\n      }\n    });\n  },\n  xmlDecode: function(text) {\n    return text.replace(/&([a-z]*);/, function(c) {\n      switch (c) {\n        case '&lt;': return '<';\n        case '&gt;': return '>';\n        case '&amp;': return '&';\n        case '&apos;': return '\\'';\n        case '&quot;': return '\"';\n        default: return c;\n      }\n    });\n  },\n  validInt: function(value) {\n    var i = parseInt(value, 10);\n    return !isNaN(i) ? i : 0;\n  },\n\n  isDateFmt: function(fmt) {\n    if (!fmt) { return false; }\n\n    // must remove all chars inside quotes and []\n    fmt = fmt.replace(/\\[[^\\]]*]/g, '');\n    fmt = fmt.replace(/\"[^\"]*\"/g, '');\n    // then check for date formatting chars\n    var result = fmt.match(/[ymdhMsb]+/) !== null;\n    return result;\n  },\n\n  fs: {\n    exists: function(path) {\n      return new PromishLib.Promish(function(resolve) {\n        fs.exists(path, function(exists) {\n          resolve(exists);\n        });\n      });\n    }\n  },\n  \n  toIsoDateString: function(dt) {\n    return dt.toIsoString().subsstr(0, 10);\n  }\n};\n\n"]}