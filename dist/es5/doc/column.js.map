{"version":3,"sources":["../../../lib/doc/column.js"],"names":["_","require","colCache","Column","module","exports","worksheet","number","defn","_worksheet","_number","prototype","letter","n2l","isCustomWidth","width","undefined","header","_header","key","style","hidden","outlineLevel","value","_hidden","headers","Array","forEach","text","index","getCell","_key","column","getColumnKey","deleteColumnKey","setColumnKey","_outlineLevel","collapsed","properties","outlineLevelCol","toString","JSON","stringify","length","equivalentTo","other","isEqual","isDefault","s","font","numFmt","alignment","border","fill","headerCount","eachCell","options","iteratee","colNumber","includeEmpty","eachRow","row","rowNumber","cell","findCell","_applyStyle","name","toModel","columns","cols","col","min","max","push","fromModel","count"],"mappings":"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","file":"column.js","sourcesContent":["/**\n * Copyright (c) 2014-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar _ = require('../utils/under-dash');\n\nvar colCache = require('../utils/col-cache');\n// Column defines the column properties for 1 column.\n// This includes header rows, widths, key, (style), etc.\n// Worksheet will condense the columns as appropriate during serialization\nvar Column = module.exports = function(worksheet, number, defn) {\n  this._worksheet = worksheet;\n  this._number = number;\n  if (defn !== false) {\n    // sometimes defn will follow\n    this.defn = defn;\n  }\n};\n\nColumn.prototype = {\n  get number() {\n    return this._number;\n  },\n  get worksheet() {\n    return this._worksheet;\n  },\n  get letter() {\n    return colCache.n2l(this._number);\n  },\n  get isCustomWidth() {\n    return (this.width !== undefined) && (this.width !== 8);\n  },\n  get defn() {\n    return {\n      header: this._header,\n      key: this.key,\n      width: this.width,\n      style: this.style,\n      hidden: this.hidden,\n      outlineLevel: this.outlineLevel\n    };\n  },\n  set defn(value) {\n    if (value) {\n      this.key = value.key;\n      this.width = value.width;\n      this.outlineLevel = value.outlineLevel;\n      if (value.style) {\n        this.style = value.style;\n      } else {\n        this.style = {};\n      }\n\n      // headers must be set after style\n      this.header = value.header;\n      this._hidden = !!value.hidden;\n    } else {\n      delete this._header;\n      delete this.key;\n      delete this.width;\n      this.style = {};\n      this.outlineLevel = 0;\n    }\n  },\n  get headers() {\n    return this._header && (this._header instanceof Array) ? this._header : [this._header];\n  },\n  get header() {\n    return this._header;\n  },\n  set header(value) {\n    if (value !== undefined) {\n      this._header = value;\n      this.headers.forEach((text, index) => {\n        this._worksheet.getCell(index + 1, this.number).value = text;\n      });\n    } else {\n      this._header = [];\n    }\n  },\n  get key() {\n    return this._key;\n  },\n  set key(value) {\n    const column = this._key && this._worksheet.getColumnKey(this._key);\n    if (column === this) {\n      this._worksheet.deleteColumnKey(this._key);\n    }\n\n    this._key = value;\n    if (value) {\n      this._worksheet.setColumnKey(this._key, this);\n    }\n  },\n  get hidden() {\n    return !!this._hidden;\n  },\n  set hidden(value) {\n    this._hidden = value;\n  },\n  get outlineLevel() {\n    return this._outlineLevel || 0;\n  },\n  set outlineLevel(value) {\n    this._outlineLevel = value;\n  },\n  get collapsed() {\n    return !!(this._outlineLevel && (this._outlineLevel >= this._worksheet.properties.outlineLevelCol));\n  },\n\n  toString: function() {\n    return JSON.stringify({\n      key: this.key,\n      width: this.width,\n      headers: this.headers.length ? this.headers : undefined\n    });\n  },\n  equivalentTo: function(other) {\n    return (this.width === other.width) &&\n            (this.hidden === other.hidden) &&\n            (this.outlineLevel === other.outlineLevel) &&\n            _.isEqual(this.style, other.style);\n  },\n  get isDefault() {\n    if (this.isCustomWidth) {\n      return false;\n    }\n    if (this.hidden) {\n      return false;\n    }\n    if (this.outlineLevel) {\n      return false;\n    }\n    var s = this.style;\n    if (s && (s.font || s.numFmt || s.alignment || s.border || s.fill)) {\n      return false;\n    }\n    return true;\n  },\n  get headerCount() {\n    return this.headers.length;\n  },\n\n  eachCell: function(options, iteratee) {\n    var colNumber = this.number;\n    if (!iteratee) {\n      iteratee = options;\n      options = null;\n    }\n    if (options && options.includeEmpty) {\n      this._worksheet.eachRow(options, function(row, rowNumber) {\n        iteratee(row.getCell(colNumber), rowNumber);\n      });\n    } else {\n      this._worksheet.eachRow(function(row, rowNumber) {\n        var cell = row.findCell(colNumber);\n        if (cell) {\n          iteratee(cell, rowNumber);\n        }\n      });\n    }\n  },\n\n  // =========================================================================\n  // styles\n  _applyStyle: function(name, value) {\n    this.style[name] = value;\n    this.eachCell(function(cell) {\n      cell[name] = value;\n    });\n    return value;\n  },\n\n  get numFmt() {\n    return this.style.numFmt;\n  },\n  set numFmt(value) {\n    this._applyStyle('numFmt', value);\n  },\n  get font() {\n    return this.style.font;\n  },\n  set font(value) {\n    this._applyStyle('font', value);\n  },\n  get alignment() {\n    return this.style.alignment;\n  },\n  set alignment(value) {\n    this._applyStyle('alignment', value);\n  },\n  get border() {\n    return this.style.border;\n  },\n  set border(value) {\n    this._applyStyle('border', value);\n  },\n  get fill() {\n    return this.style.fill;\n  },\n  set fill(value) {\n    this._applyStyle('fill', value);\n  }\n};\n\n// =============================================================================\n// static functions\n\nColumn.toModel = function(columns) {\n  // Convert array of Column into compressed list cols\n  var cols = [];\n  var col = null;\n  if (columns) {\n    columns.forEach(function(column, index) {\n      if (column.isDefault) {\n        if (col) {\n          col = null;\n        }\n      } else if (!col || !column.equivalentTo(col)) {\n        col = {\n          min: index + 1,\n          max: index + 1,\n          width: column.width,\n          style: column.style,\n          isCustomWidth: column.isCustomWidth,\n          hidden: column.hidden,\n          outlineLevel: column.outlineLevel,\n          collapsed: column.collapsed\n        };\n        cols.push(col);\n      } else {\n        col.max = index + 1;\n      }\n    });\n  }\n  return cols.length ? cols : undefined;\n};\n\nColumn.fromModel = function(worksheet, cols) {\n  cols = cols || [];\n  var columns = [];\n  var count = 1;\n  var index = 0;\n  while (index < cols.length) {\n    var col = cols[index++];\n    while (count < col.min) {\n      columns.push(new Column(worksheet, count++));\n    }\n    while (count <= col.max) {\n      columns.push(new Column(worksheet, count++, col));\n    }\n  }\n  return columns.length ? columns : null;\n};\n"]}